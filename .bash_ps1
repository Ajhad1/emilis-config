################### customization for the command prompt #################

#### code to input separator ####
# Fill with minuses
# (this is recalculated every time the prompt is shown in function prompt_command):
fill="--- "

reset_style='\[\033[00m\]'
if [ -z "$VIM" ];
then status_style=$reset_style'\[\033[0;90m\]' # gray color; use 0;37m for lighter color
else status_style=$reset_style'\[\033[0;90;107m\]'
fi
prompt_style=$reset_style
command_style=$reset_style'\[\033[1;29m\]' # bold black
# Prompt variable:

OLD_PS1="$PS1"
PS1="$status_style"'$fill $name \t\n'"$prompt_style$OLD_PS1$command_style"

# Reset color for command output
# (this one is invoked every time before a command is executed):
trap 'echo -ne "\e[0m"' DEBUG


function prompt_command {

    # create a $fill of all screen width minus the time string and a space and USER and a space:
    name=$(fc -l -1 | awk -v u="$USER" '{if ($2=="sudo") { if ($3=="-u") u=$4; else u="root"; }; printf "%s",u}')
    let fillsize=${COLUMNS}-10-${#name}
    fill=""
    while [ "$fillsize" -gt "0" ]
    do
        fill="-${fill}" # fill with underscores to work on 
        let fillsize=${fillsize}-1
    done
	
    # If this is an xterm set the title to user@host:dir
    case "$TERM" in
    xterm*|rxvt*)
        bname=`basename "${PWD/$HOME/~}"`
        echo -ne "\033]0;${bname}: ${USER}@${HOSTNAME}: ${PWD/$HOME/~}\007"
        ;;
    *)
        ;;
    esac
  
}
PROMPT_COMMAND=prompt_command

### my personal settings ###
force_color_prompt=yes             # add color to terminals
HISTCONTROL=ignoreboth # don't put duplicate lines or lines starting with space in the history.
shopt -s checkwinsize     # check the window size after each command and, if necessary, update the values of LINES and COLUMNS.

####### load my newest personalization file on TTY load ##########
echo "Pulling latest personalization file from remote repository. "
printf "....... " && git -C ~/linux-config/ pull # pull on load
echo "Comparing local personalization file to remote in git."
git -C ~/linux-config/ add . > /dev/null && git -C ~/linux-config/ commit -m " " --allow-empty-message --short > /dev/null # adds and commits any changes
printf "....... " && git -C ~/linux-config/ status --short # get status on load
echo "If local changes push using gitttypush"

########### aliases ################
## command replacements ##
alias cd='function _f { \cd "$1"/; ls;}; _f' # replace cd with cd then ls
alias cd0='/bin/cd ' # allow cd to be used normally
alias cpp='rsync -ah --info=progress2 ' # use rsync instead of cp for its progress
alias cp0='/bin/cp ' # allows sp to be used normally
alias ls='ls -ahF --color=auto ' # auto runs with color
alias ls0='/bin/ls ' # allows ls to be used normally
alias cat='highlight -O ansi --force --syntax=sh -n ' # runs highlight instead of cat
alias cat0='bin/cat ' # allows cat to be run normally
alias egrep='egrep --color=auto ' # auto runs with color
alias fgrep='fgrep --color=auto ' # auto runs with color
alias grep='grep --color=auto ' # auto runs with color
alias wget='wget -c ' # auto runs with -c
alias vi='vim'
   
## fix typos ##
alias cd..='cd ../' # allows typo to still work
alias cd~='cd ~' # allows typo to still work
alias gittypull='gitttypull' # allows typo to still work
alias gittyadd='gitttyadd' # allows typo to still work
alias gittycommit='gitttycommit' # allows typo to still work
alias gittypush='gitttypush' # allows typo to still work
alias gitttycomit='gitttycommit' # allows typo to still work
alias gittycomit='gitttycommit' # allows typo to still work
alias gitty='gittty' # allows typo to still work

## shortcuts built-in on other commands ##
alias ..='\cd ../; ls' # allows shortcut for cd ../
alias ...='\cd ../../; ls' # shortcut for cd ../../
alias ....='\cd ../../../; ls' # shortcut for cd ../../../
alias cdl='function _f { \cd "$1"/; ls;}; _f' # cd then ls
alias cdltest='cd_func' # cd then ls
alias cpp='rsync -ah --info=progress2 ' # use rsync instead of cp for its progress
alias la='ls -a ' # ls with -a for show hidden
alias ll='ls -la ' # short cut for long list
alias lstest='ls -Alhf --color=auto ' # supposed to be a good ls

### new commands ###
alias getip='curl ifconfig.me' # get public ip
alias getlocal='hostname -I' # get local ip
alias getpublic='curl ifconfig.me' # get public ip
alias trash='function _t { mkdir --parents ~/.local/share/Trash/files; mv --force -t ~/.local/share/Trash/files "$@"; echo "\"$@\" has been moved to the Trash.";}; _t' # sends to trash instead of deleting
alias s='sudo ' # shortcut to sudo
alias bashreload='reloadbash' # shortcut to shortcut to reload bash
alias reloadbash='source ~/.bashrc && echo Bash reloaded' # shortcut to reload bash
alias gitttypull='git -C ~/linux-config/ pull' # git pull tty
alias gitttyadd='git -C ~/linux-config/ add .' # git add changes tty
alias gitttycommit='git -C ~/linux-config/ add . && git -C ~/linux-config/ commit -m " " --allow-empty-message' # git commit tty
alias gitttypush='git -C ~/linux-config/ add . && git -C ~/linux-config/ commit -m " " --allow-empty-message && git -C ~/linux-config/ push' # git push tty
alias gittty='git -C ~/linux-config' # auto gets location of tty file
alias common='commonlist | less' # outputs common commands into less

################ common trying out ##################
alias untar='tar -zxvf ' # shortcut to untar
alias c='clear' # shortcut to clear screen
alias ports='netstat -tulanp ' # shows open ports
alias mvf='function _mv { mv $@; cd $2; }; _mv' # moves files and cds into it
alias mkdirf='function _mk { mkdir $1; cd $1; }; _mk' # makes directory and cds into it
alias hists='history | grep ' # searches history

## cover my butt ##
alias mkdir='mkdir -pv ' # always runs mkdir with create parent if needed
alias rm='rm -I --preserve-root ' # do not delete / or prompt if deleting more than 3 files at a time #
alias mv='mv -i ' # always runs in confirmation mode #
alias cp='cp -i ' # always runs in confirmation mode #
alias ln='ln -i ' # always runs in confirmation mode #
alias chown='chown --preserve-root ' # Parenting changing perms on / #
alias chmod='chmod --preserve-root ' # Parenting changing perms on / #
alias chgrp='chgrp --preserve-root ' # Parenting changing perms on / #
alias sudo='sudo ' # always checks commands after sudo for aliases
alias yum='sudo yum ' # auto run yum with sudo
alias apt-get='sudo apt-get ' # always runs apt-get as sudo
alias dnf='sudo dnf ' # always runs dnf as sudo


################# functions #######################
## testing function as alias ##
function cd_func
{
	\cd "$1"; 
	ls; 
} 

# Syntax: "repeat [X] [command]"
function repeat      
{
    local i max
    max=$1; shift;
    for ((i=1; i <= max ; i++)); do  # --> C-like syntax
        eval "$@";
    done
}

### returns my most common commands ###
function mycommon
{
	history | awk '{CMD[$2]++;count++;}END { for (a in CMD)print CMD[a] " " CMD[a]/count*100 "% " a;}' | grep -v "./" | column -c3 -s " " -t | sort -nr | nl |  head -n10
}

### list common commands ###
function commonlist 
{
	declare -a commandlist=(awk sed git pwd ls cat cp mv mkdir rmdir rm touch find grep sudo df du head tail diff tar chmod chown chgrp kill ping wget uname top history man echo zip unzip hostname useradd userdel)
	declare -a descriplist=()
	for i in ${commandlist[@]}; do
		commandstr=$(whatis $i);
		echo -e $commandstr|sed 's/ -/\n\t-/g';
	done
	echo -e "cd (1)\n\t- Change the shell working directory.;";
	echo -e "jobs (1)\n\t- Display status of jobs. List the active jobs.;";
        echo -e "!* (1)\n\t- Copy previous options and arguments.;";
        echo -e "!! (1)\n\t- Copy complete last command line.;";
}

### calls appropriate extraction tool ###
function extract 
{
 if [ -z "$1" ]; then
    # display usage if no parameters given
    echo "Usage: extract <path/file_name>.<zip|rar|bz2|gz|tar|tbz2|tgz|Z|7z|xz|ex|tar.bz2|tar.gz|tar.xz>"
    echo "       extract <path/file_name_1.ext> [path/file_name_2.ext] [path/file_name_3.ext]"
    return 1
 else
    for n in $@
    do
      if [ -f "$n" ] ; then
          case "${n%,}" in
            *.tar.bz2|*.tar.gz|*.tar.xz|*.tbz2|*.tgz|*.txz|*.tar) 
                         tar xvf "$n"       ;;
            *.lzma)      unlzma ./"$n"      ;;
            *.bz2)       bunzip2 ./"$n"     ;;
            *.rar)       unrar x -ad ./"$n" ;;
            *.gz)        gunzip ./"$n"      ;;
            *.zip)       unzip ./"$n"       ;;
            *.z)         uncompress ./"$n"  ;;
            *.7z|*.arj|*.cab|*.chm|*.deb|*.dmg|*.iso|*.lzh|*.msi|*.rpm|*.udf|*.wim|*.xar)
                         7z x ./"$n"        ;;
            *.xz)        unxz ./"$n"        ;;
            *.exe)       cabextract ./"$n"  ;;
            *)
                         echo "extract: '$n' - unknown archive method"
                         return 1
                         ;;
          esac
      else
          echo "'$n' - file does not exist"
          return 1
      fi
    done
fi
}



################## auto-complete? #############
function _complete_hosts 
{
    COMPREPLY=()
    cur="${COMP_WORDS[COMP_CWORD]}"
    host_list=`{
        for c in /etc/ssh_config /etc/ssh/ssh_config ~/.ssh/config
        do [ -r $c ] && sed -n -e 's/^Host[[:space:]]//p' -e 's/^[[:space:]]*HostName[[:space:]]//p' $c
        done
        for k in /etc/ssh_known_hosts /etc/ssh/ssh_known_hosts ~/.ssh/known_hosts
        do [ -r $k ] && egrep -v '^[#\[]' $k|cut -f 1 -d ' '|sed -e 's/[,:].*//g'
        done
        sed -n -e 's/^[0-9][0-9\.]*//p' /etc/hosts; }|tr ' ' '\n'|grep -v '*'`
    COMPREPLY=( $(compgen -W "${host_list}" -- $cur))
    return 0
}
complete -F _complete_hosts ssh
complete -F _complete_hosts sshs
complete -F _complete_hosts host
complete -F _complete_hosts telnet
complete -F _complete_hosts ping







